 No JWT token found in cookies
 POST /api/image-token 200 in 17ms
API handler should not return a value, received object.
 OPTIONS /api/submit-component-budget-v2 204 in 16ms
ğŸ“¨ [V2] Incoming budget submit request { method: 'POST', ts: '2025-08-28T07:49:02.336Z' }
âœ… Authentication successful for user ID: f8465b52-d8ca-4f66-91a8-428b3f065df6
ğŸ§© [V2] Parsed payload overview {
  userId: 'f8465b52-d8ca-4f66-91a8-428b3f065df6',
  context: {
    componentId: 'cc8b240d-f251-49f0-9ad4-ee94becb0fc4',
    userRole: 'Admin',
    language: 'pt'
  },
  hasForgeData: true,
  hasPostForgeData: true,
  hasBudgetCalcs: false
}
ğŸ§ª [V2] Derived fields {
  submission_mode: 'admin',
  componentId: 'cc8b240d-f251-49f0-9ad4-ee94becb0fc4',
  final_price_per_piece: null,
  selectedMachine: '|c2ed89cd-eb2b-4c40-a68f-4d69593e72ef',
  selectedMaterial: '|b8a38cd5-e998-414f-835c-be5f6363f11f',
  production: {
    items_per_table: 123,
    print_min_per_table: 83,
    g_per_table: 123,
    support_g_per_table: null,
    modeling_min: 83,
    slicing_min: 83,
    maintenance_min_per_table: 83
  },
  curing: {
    curing_required: false,
    curing_machine_id: null,
    curing_min: null,
    curing_items_per_table: null
  },
  comments: { internal: true, external: true }
}
API handler should not return a value, received object.
 OPTIONS /api/image-token 204 in 20ms
âš  No JWT token found in cookies
 POST /api/image-token 200 in 15ms
ğŸ”§ [V2] Extracting budget-specific machine/material IDs {
  componentId: 'cc8b240d-f251-49f0-9ad4-ee94becb0fc4',
  selectedMachine: '|c2ed89cd-eb2b-4c40-a68f-4d69593e72ef',
  selectedMaterial: '|b8a38cd5-e998-414f-835c-be5f6363f11f'
}
âœ… [V2] Valid budget machine ID extracted from selection: c2ed89cd-eb2b-4c40-a68f-4d69593e72ef
âœ… [V2] Valid budget material ID extracted from selection: b8a38cd5-e998-414f-835c-be5f6363f11f
ğŸ [V2] Final budget machine/material IDs {
  budgetMachineId: 'c2ed89cd-eb2b-4c40-a68f-4d69593e72ef',
  budgetMaterialId: 'b8a38cd5-e998-414f-835c-be5f6363f11f'
}
ğŸ“Š [V2] Updating component status { componentId: 'cc8b240d-f251-49f0-9ad4-ee94becb0fc4', statusOrder: 2 }
â„¹ï¸ [V2] Component status already correct, no update needed {
  componentId: 'cc8b240d-f251-49f0-9ad4-ee94becb0fc4',
  currentStatusId: '986df83e-0fe9-4ba4-9876-f694bad6b801',
  targetStatusId: '986df83e-0fe9-4ba4-9876-f694bad6b801'
}
ğŸ”§ [V2] Building INSERT {
  statusId: 'd0ae4003-61e4-43d1-af19-744929a13652',
  client_id: null,
  curing_min_edited: null
}
ğŸ“ [V2] INSERT preview {
  forge_id: 'f8465b52-d8ca-4f66-91a8-428b3f065df6',
  component_id: 'cc8b240d-f251-49f0-9ad4-ee94becb0fc4',
  status_id: 'd0ae4003-61e4-43d1-af19-744929a13652',
  client_id: null,
  submission_mode: 'admin',
  is_active: false,
  final_price_per_piece: null,
  budget_machine_id: 'c2ed89cd-eb2b-4c40-a68f-4d69593e72ef',
  budget_material_id: 'b8a38cd5-e998-414f-835c-be5f6363f11f',
  support_material_id: null,
  support_g_per_table: null,
  items_per_table: 123,
  print_min_per_table: 83,
  g_per_table: 123,
  modeling_min: 83,
  slicing_min: 83,
  maintenance_min_per_table: 83,
  curing_machine_id: null,
  curing_min: null,
  curing_items_per_table: null,
  internal_notes: '123',
  client_notes: '123'
}
âœ… [V2] Budget inserted (pre-finishings) {
  budgetId: 'd5a2b908-7cb2-4100-af38-093d1f640f6e',
  componentId: 'cc8b240d-f251-49f0-9ad4-ee94becb0fc4',
  userId: 'f8465b52-d8ca-4f66-91a8-428b3f065df6',
  ts: '2025-08-28T07:49:02.876Z'
}
ğŸ§± [V2] Processing Postâ€‘Forge finishings { count: 3 }
ğŸ§ª [V2] Finishing drying validation {
  finishing_id: '09aedc80-dc61-4491-b14d-d5c7b9fbafa2',
  finishingIndex: 0,
  need_drying: false,
  requiresDrying: false,
  provided_drying_hours: 0
}
âœï¸ [V2] Updated FinishingMaterial {
  finishing_material_id: '4c7429c6-1c35-49aa-98a3-801935a2925a',
  updated_fields: [ 'default_unit_cost = $1' ]
}
âœï¸ [V2] Updated FinishingMaterial {
  finishing_material_id: '6b1f7d0e-9a8d-4060-a40c-ffbbdbbba91d',
  updated_fields: [ 'default_unit_cost = $1' ]
}
ğŸ§¹ [V2] Removed FFM associations not present in submission {
  finishing_id: '09aedc80-dc61-4491-b14d-d5c7b9fbafa2',
  removed_count: 1
}
ğŸ”— [V2] Inserted finishing with materials {
  component_budget_finishing_id: 'f28a247e-2285-4a86-8118-a951ea2cb1af',
  materials_count: 2
}
ğŸ§ª [V2] Finishing drying validation {
  finishing_id: '1f2323ac-266e-40b7-ba65-8e14f395d3dc',
  finishingIndex: 1,
  need_drying: true,
  requiresDrying: true,
  provided_drying_hours: 1.3833333333333333
}
âœï¸ [V2] Updated FinishingMaterial {
  finishing_material_id: '08f30fc5-2c82-4a9b-903d-b6b5e4bf8a67',
  updated_fields: [ 'default_unit_cost = $1' ]
}
ğŸ§¹ [V2] Removed FFM associations not present in submission {
  finishing_id: '1f2323ac-266e-40b7-ba65-8e14f395d3dc',
  removed_count: 1
}
ğŸ”— [V2] Inserted finishing with materials {
  component_budget_finishing_id: 'c89bc52b-5e10-4654-8044-a0bd6e8d5ff0',
  materials_count: 1
}
ğŸ§ª [V2] Finishing drying validation {
  finishing_id: '0a21c3d4-6569-4ad7-bdb7-484cd2fda3bf',
  finishingIndex: 2,
  need_drying: true,
  requiresDrying: true,
  provided_drying_hours: 1.3833333333333333
}
âœï¸ [V2] Updated FinishingMaterial {
  finishing_material_id: '6b1f7d0e-9a8d-4060-a40c-ffbbdbbba91d',
  updated_fields: [ 'default_unit_cost = $1' ]
}
ğŸ§¹ [V2] Removed FFM associations not present in submission {
  finishing_id: '0a21c3d4-6569-4ad7-bdb7-484cd2fda3bf',
  removed_count: 1
}
ğŸ”— [V2] Inserted finishing with materials {
  component_budget_finishing_id: '946c61f2-386b-4616-a250-2dd407719e98',
  materials_count: 1
}
ğŸ“¦ [V2] Postâ€‘Forge persisted {
  budgetId: 'd5a2b908-7cb2-4100-af38-093d1f640f6e',
  finishingsInserted: 3,
  materialsInserted: 4
}
ğŸ”„ [OneDrive] Attempting to move item with auto-rename {
  itemId: '01IK7GO4RRMPXM7LUAFRG3GITWTJEPYP6R',
  targetParentId: '01IK7GO4X5DOODWEVNVRE3VU5YJAP2WZXJ',
  desiredName: 'IMG_20250813_012520HAHAHAHA.JPG',
  maxAttempts: 10
}
ğŸ”„ [OneDrive] Attempt 1/10: Moving with name "IMG_20250813_012520HAHAHAHA.JPG"
âœ… [OneDrive] File moved successfully {
  originalName: 'IMG_20250813_012520HAHAHAHA.JPG',
  finalName: 'IMG_20250813_012520HAHAHAHA.JPG',
  attempt: 1,
  itemId: '01IK7GO4RRMPXM7LUAFRG3GITWTJEPYP6R'
}
ğŸ”„ [OneDrive] Attempting to move item with auto-rename {
  itemId: '01IK7GO4VIWNSFP75RR5GI6KUF4QXW2HKC',
  targetParentId: '01IK7GO4X5DOODWEVNVRE3VU5YJAP2WZXJ',
  desiredName: 'PARALELIPIPEDO 100 50MM (HOLLOWED).STL_ORI.STL',
  maxAttempts: 10
}
ğŸ”„ [OneDrive] Attempt 1/10: Moving with name "PARALELIPIPEDO 100 50MM (HOLLOWED).STL_ORI.STL"
âŒ Exception during moveOneDriveItem for item 01IK7GO4VIWNSFP75RR5GI6KUF4QXW2HKC to new parent: {"id":"01IK7GO4X5DOODWEVNVRE3VU5YJAP2WZXJ"}. Error: Graph API error (409): Name already exists {
  code: 'nameAlreadyExists',
  message: 'Name already exists',
  innerError: {
    date: '2025-08-28T07:49:07',
    'request-id': 'd417b8a0-9a13-405e-9727-ba6c5431bd2c',
    'client-request-id': 'd417b8a0-9a13-405e-9727-ba6c5431bd2c'
  }
}
âš ï¸ [OneDrive] Move attempt failed {
  attemptName: 'PARALELIPIPEDO 100 50MM (HOLLOWED).STL_ORI.STL',
  attempt: 1,
  errorCode: 'unknown',
  errorMessage: 'Graph API error (409): Name already exists'
}
ğŸ”„ [OneDrive] Name conflict detected, trying alternative name...
ğŸ”„ [OneDrive] Attempt 2/10: Moving with name "PARALELIPIPEDO 100 50MM (HOLLOWED).STL_ORI (1).STL"
âŒ Exception during moveOneDriveItem for item 01IK7GO4VIWNSFP75RR5GI6KUF4QXW2HKC to new parent: {"id":"01IK7GO4X5DOODWEVNVRE3VU5YJAP2WZXJ"}. Error: Graph API error (409): Name already exists {
  code: 'nameAlreadyExists',
  message: 'Name already exists',
  innerError: {
    date: '2025-08-28T07:49:07',
    'request-id': '1bac3aff-2e22-4c17-bd1a-9f3509383737',
    'client-request-id': '1bac3aff-2e22-4c17-bd1a-9f3509383737'
  }
}
âš ï¸ [OneDrive] Move attempt failed {
  attemptName: 'PARALELIPIPEDO 100 50MM (HOLLOWED).STL_ORI (1).STL',
  attempt: 2,
  errorCode: 'unknown',
  errorMessage: 'Graph API error (409): Name already exists'
}
ğŸ”„ [OneDrive] Name conflict detected, trying alternative name...
ğŸ”„ [OneDrive] Attempt 3/10: Moving with name "PARALELIPIPEDO 100 50MM (HOLLOWED).STL_ORI (2).STL"
âŒ Exception during moveOneDriveItem for item 01IK7GO4VIWNSFP75RR5GI6KUF4QXW2HKC to new parent: {"id":"01IK7GO4X5DOODWEVNVRE3VU5YJAP2WZXJ"}. Error: Graph API error (409): Name already exists {
  code: 'nameAlreadyExists',
  message: 'Name already exists',
  innerError: {
    date: '2025-08-28T07:49:07',
    'request-id': 'e0a7eafc-8cd9-45f7-8f53-5f4351dca07c',
    'client-request-id': 'e0a7eafc-8cd9-45f7-8f53-5f4351dca07c'
  }
}
âš ï¸ [OneDrive] Move attempt failed {
  attemptName: 'PARALELIPIPEDO 100 50MM (HOLLOWED).STL_ORI (2).STL',
  attempt: 3,
  errorCode: 'unknown',
  errorMessage: 'Graph API error (409): Name already exists'
}
ğŸ”„ [OneDrive] Name conflict detected, trying alternative name...
ğŸ”„ [OneDrive] Attempt 4/10: Moving with name "PARALELIPIPEDO 100 50MM (HOLLOWED).STL_ORI (3).STL"
âŒ Exception during moveOneDriveItem for item 01IK7GO4VIWNSFP75RR5GI6KUF4QXW2HKC to new parent: {"id":"01IK7GO4X5DOODWEVNVRE3VU5YJAP2WZXJ"}. Error: Graph API error (409): Name already exists {
  code: 'nameAlreadyExists',
  message: 'Name already exists',
  innerError: {
    date: '2025-08-28T07:49:08',
    'request-id': 'ff6b93a4-da37-45a4-bbb2-e476b11ec356',
    'client-request-id': 'ff6b93a4-da37-45a4-bbb2-e476b11ec356'
  }
}
âš ï¸ [OneDrive] Move attempt failed {
  attemptName: 'PARALELIPIPEDO 100 50MM (HOLLOWED).STL_ORI (3).STL',
  attempt: 4,
  errorCode: 'unknown',
  errorMessage: 'Graph API error (409): Name already exists'
}
ğŸ”„ [OneDrive] Name conflict detected, trying alternative name...
ğŸ”„ [OneDrive] Attempt 5/10: Moving with name "PARALELIPIPEDO 100 50MM (HOLLOWED).STL_ORI (4).STL"
âŒ Exception during moveOneDriveItem for item 01IK7GO4VIWNSFP75RR5GI6KUF4QXW2HKC to new parent: {"id":"01IK7GO4X5DOODWEVNVRE3VU5YJAP2WZXJ"}. Error: Graph API error (409): Name already exists {
  code: 'nameAlreadyExists',
  message: 'Name already exists',
  innerError: {
    date: '2025-08-28T07:49:08',
    'request-id': '5ce833b0-74de-4ba8-8d54-742fdd9da946',
    'client-request-id': '5ce833b0-74de-4ba8-8d54-742fdd9da946'
  }
}
âš ï¸ [OneDrive] Move attempt failed {
  attemptName: 'PARALELIPIPEDO 100 50MM (HOLLOWED).STL_ORI (4).STL',
  attempt: 5,
  errorCode: 'unknown',
  errorMessage: 'Graph API error (409): Name already exists'
}
ğŸ”„ [OneDrive] Name conflict detected, trying alternative name...
ğŸ”„ [OneDrive] Attempt 6/10: Moving with name "PARALELIPIPEDO 100 50MM (HOLLOWED).STL_ORI (5).STL"
âœ… [OneDrive] File moved successfully {
  originalName: 'PARALELIPIPEDO 100 50MM (HOLLOWED).STL_ORI.STL',
  finalName: 'PARALELIPIPEDO 100 50MM (HOLLOWED).STL_ORI (5).STL',
  attempt: 6,
  itemId: '01IK7GO4VIWNSFP75RR5GI6KUF4QXW2HKC'
}
ğŸ“ [V2] File was automatically renamed to avoid conflict {
  originalName: 'Paralelipipedo 100 50mm (hollowed).stl_ori.stl',
  sanitizedName: 'PARALELIPIPEDO 100 50MM (HOLLOWED).STL_ORI.STL',
  finalName: 'PARALELIPIPEDO 100 50MM (HOLLOWED).STL_ORI (5).STL',
  budgetId: 'd5a2b908-7cb2-4100-af38-093d1f640f6e',
  totalRenamed: 1
}
ğŸ“ [V2] File upload summary {
  budgetId: 'd5a2b908-7cb2-4100-af38-093d1f640f6e',
  totalFiles: 2,
  filesRenamed: 1,
  filesWithOriginalName: 1
}
ğŸ [V2] Request finished { ts: '2025-08-28T07:49:08.806Z', took_ms: 6470 }
 POST /api/submit-component-budget-v2 201 in 6492ms
API handler should not return a value, received object.
 OPTIONS /api/session 204 in 45ms
API handler should not return a value, received object.
 OPTIONS /api/getorderdetails/32eaa430-6e70-46b4-a3bb-18b05e84efde 204 in 75ms
API handler should not return a value, received object.
 OPTIONS /api/session 204 in 31ms
API handler should not return a value, received object.
 OPTIONS /api/getorderdetails/32eaa430-6e70-46b4-a3bb-18b05e84efde 204 in 31ms
âœ… SessÃ£o vÃ¡lida para: admin2@mail.com
 GET /api/session 200 in 43ms
âœ… Authentication successful for user ID: f8465b52-d8ca-4f66-91a8-428b3f065df6
âœ… SessÃ£o vÃ¡lida para: admin2@mail.com
 GET /api/session 200 in 79ms
API handler should not return a value, received object.
 OPTIONS /api/refresh-token 204 in 76ms
API handler should not return a value, received object.
 OPTIONS /api/db-status 204 in 82ms
âœ… SessÃ£o vÃ¡lida para: admin2@mail.com
 GET /api/session 200 in 38ms
âŒ Error refreshing token: Error: getaddrinfo EAI_AGAIN ep-bitter-heart-abjw1xvb-pooler.eu-west-2.aws.neon.tech
    at async handler (src/pages/api/refresh-token.js:71:16)
  69 |     }
  70 |
> 71 |     client_pg = await pool.connect();
     |                ^
  72 |
  73 |     // Verify fingerprint matches
  74 |     const fingerprintHash = hashValue(fingerprint); {
  errno: -3001,
  code: 'EAI_AGAIN',
  syscall: 'getaddrinfo',
  hostname: 'ep-bitter-heart-abjw1xvb-pooler.eu-west-2.aws.neon.tech'
}
 POST /api/refresh-token 500 in 214ms
âŒ Error translating text "Support Removal" to lang "pt": getaddrinfo EAI_AGAIN ep-bitter-heart-abjw1xvb-pooler.eu-west-2.aws.neon.tech
âœ… New database connection established
 GET /api/db-status 200 in 825ms
API handler should not return a value, received object.
 OPTIONS /api/get-username 204 in 14ms
âœ… Authentication successful for user ID: f8465b52-d8ca-4f66-91a8-428b3f065df6
ğŸ” Searching for user with ID: f8465b52-d8ca-4f66-91a8-428b3f065df6
ğŸ” User ID type: string
ğŸ” User ID length: 36
ğŸ” Executing query: SELECT id, name, surname FROM "User" WHERE id = $1 with parameter: f8465b52-d8ca-4f66-91a8-428b3f065df6
 GET /api/db-status 200 in 113ms
âœ… New database connection established
 GET /api/db-status 200 in 69ms
âœ… New database connection established
ğŸ” Query result rows count: 1
ğŸ” Found user data: {
  id: 'f8465b52-d8ca-4f66-91a8-428b3f065df6',
  name: 'admin2',
  surname: 'admin2'
}
 GET /api/get-username 304 in 657ms
 GET /api/getorderdetails/32eaa430-6e70-46b4-a3bb-18b05e84efde 200 in 3244ms
âœ… Authentication successful for user ID: f8465b52-d8ca-4f66-91a8-428b3f065df6
 âœ“ Compiled /api/get-edit-orderdetail in 220ms
API handler should not return a value, received object.
 OPTIONS /api/get-budgets-by-component?orderId=32eaa430-6e70-46b4-a3bb-18b05e84efde 204 in 68ms
API handler should not return a value, received object.
 OPTIONS /api/get-edit-orderdetail?resource=status 204 in 257ms
ğŸš€ Starting get-budgets-by-component API request at 2025-08-28T07:49:13.596Z
âœ… Order ID validation passed: 32eaa430-6e70-46b4-a3bb-18b05e84efde
ğŸ”Œ Database connection established
ğŸ” Starting authentication for orderId: 32eaa430-6e70-46b4-a3bb-18b05e84efde
âœ… Authentication successful for user ID: f8465b52-d8ca-4f66-91a8-428b3f065df6
âœ… Authentication successful for user: f8465b52-d8ca-4f66-91a8-428b3f065df6
ğŸ” Verifying if order exists: 32eaa430-6e70-46b4-a3bb-18b05e84efde
âœ… Order found: nova orÃ§amentaÃ§Ã£o (Client: eu thulio)
ğŸ“Š Fetching ALL versions of components associated with order: 32eaa430-6e70-46b4-a3bb-18b05e84efde
ğŸ” Executing main query to fetch components and all budgets...
âœ… Authentication successful for user ID: f8465b52-d8ca-4f66-91a8-428b3f065df6
ğŸ“Š Found 31 component-budget combinations for order: 32eaa430-6e70-46b4-a3bb-18b05e84efde
ğŸ”„ Grouping budgets by component base, versions, and budgets...
âœ… Grouped into 2 component bases with ALL their versions
âœ… get-budgets-by-component API completed successfully in 359ms
ğŸ“Š Response summary: 2 component bases, 4 total versions (2 selected in order), 30 total budgets
ğŸ”Œ Database connection released
 GET /api/get-budgets-by-component?orderId=32eaa430-6e70-46b4-a3bb-18b05e84efde 200 in 462ms
âœ… New database connection established
âœ… New database connection established
âœ… New database connection established
 GET /api/get-edit-orderdetail?resource=status 304 in 1129ms
 GET /api/getorderdetails/32eaa430-6e70-46b4-a3bb-18b05e84efde 200 in 2422ms
API handler should not return a value, received object.
 OPTIONS /api/refresh-token 204 in 9ms
âœ… Tokens refreshed successfully for user: admin2@mail.com
 POST /api/refresh-token 200 in 426ms